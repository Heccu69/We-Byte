# Система слотов сохранений

## Описание

Полноценная система сохранений с поддержкой:
- **3 слота сохранений** в главном меню
- **Создание новых сохранений** с названием
- **Быстрое сохранение** во время игры (F5)
- **Автосохранение** каждые 5 минут
- **Удаление сохранений**

---

## Структура системы

### 1. **SaveData.cs** - Данные сохранения
Расширенная структура с метаданными:
- `slotName` - название сохранения
- `saveDateTime` - дата и время сохранения
- `slotIndex` - индекс слота (0-2)
- `playTime` - время игры
- Все игровые данные (счет, уровень, статистика)

### 2. **SaveSystem.cs** - Система сохранения
Методы для работы со слотами:
- `SaveToSlot(data, slotIndex)` - сохранить в слот
- `LoadFromSlot(slotIndex)` - загрузить из слота
- `SlotExists(slotIndex)` - проверить существование
- `DeleteSlot(slotIndex)` - удалить слот
- `GetAllSlots()` - получить все слоты
- `CreateNewSave(name)` - создать новое сохранение

### 3. **SaveSlotsManager.cs** - UI главного меню
Управление слотами в главном меню:
- Отображение 3 слотов
- Создание новых сохранений
- Загрузка игры
- Удаление сохранений

### 4. **InGameSaveManager.cs** - Сохранение во время игры
Управление сохранениями в игре:
- Быстрое сохранение (F5)
- Автосохранение каждые 5 минут
- Сбор текущих данных игры
- Уведомления о сохранении

---

## Настройка в Unity

### Часть 1: Главное меню

#### Шаг 1: Создание UI слотов

1. **Создайте Canvas для меню сохранений:**
   ```
   Hierarchy → UI → Canvas
   Имя: "SaveSlotsCanvas"
   ```

2. **Создайте 3 панели слотов:**
   
   Для каждого слота (0, 1, 2):
   ```
   Canvas → UI → Panel
   Имя: "SlotPanel_0" (1, 2)
   ```
   
   В каждой панели создайте:
   - **Text (TMP)** - название сохранения (`SlotName_0`)
   - **Text (TMP)** - информация (`SlotInfo_0`)
   - **Button** - кнопка "Играть" (`PlayButton_0`)
   - **Button** - кнопка "Удалить" (`DeleteButton_0`)

3. **Создайте панель создания сохранения:**
   ```
   Canvas → UI → Panel
   Имя: "CreateSavePanel"
   ```
   
   Внутри панели:
   - **Text (TMP)** - заголовок "Создать сохранение"
   - **Input Field (TMP)** - поле ввода названия (`SaveNameInput`)
   - **Button** - "Создать" (`CreateButton`)
   - **Button** - "Отмена" (`CancelButton`)

#### Шаг 2: Настройка SaveSlotsManager

1. **Создайте пустой объект:**
   ```
   Hierarchy → Create Empty
   Имя: "SaveSlotsManager"
   ```

2. **Добавьте компонент SaveSlotsManager**

3. **Настройте в Inspector:**
   
   **UI Слотов:**
   - Slot Panels: перетащите 3 панели слотов
   - Slot Names: перетащите 3 текста названий
   - Slot Info Texts: перетащите 3 текста информации
   - Play Buttons: перетащите 3 кнопки "Играть"
   - Delete Buttons: перетащите 3 кнопки "Удалить"
   
   **UI Создания:**
   - Create Save Panel: панель создания
   - Save Name Input: поле ввода
   - Create Button: кнопка создать
   - Cancel Button: кнопка отмены
   
   **Настройки:**
   - Game Scene Name: "GameScene" (имя вашей игровой сцены)

---

### Часть 2: Игровая сцена

#### Шаг 1: Создание UI уведомлений

1. **В игровой сцене создайте Canvas:**
   ```
   Hierarchy → UI → Canvas
   ```

2. **Создайте текст уведомления:**
   ```
   Canvas → UI → Text (TMP)
   Имя: "SaveNotificationText"
   ```
   
   Настройте:
   - Позиция: верхний правый угол
   - Цвет: зеленый или желтый
   - Font Size: 24-32
   - Alignment: Right

#### Шаг 2: Настройка InGameSaveManager

1. **Создайте пустой объект:**
   ```
   Hierarchy → Create Empty
   Имя: "InGameSaveManager"
   ```

2. **Добавьте компонент InGameSaveManager**

3. **Настройте в Inspector:**
   
   **Настройки:**
   - Save Key: F5 (клавиша быстрого сохранения)
   - Auto Save Enabled: ✓
   - Auto Save Interval: 300 (5 минут)
   
   **UI:**
   - Save Notification Text: текст уведомления
   - Notification Duration: 2 (секунды)

---

## Использование

### В главном меню:

**Создание нового сохранения:**
1. Нажмите на пустой слот
2. Введите название сохранения
3. Нажмите "Создать"
4. Игра автоматически загрузится

**Загрузка сохранения:**
1. Нажмите "Играть" на заполненном слоте
2. Игра загрузится с сохраненным прогрессом

**Удаление сохранения:**
1. Нажмите "Удалить" на слоте
2. Сохранение будет удалено

### Во время игры:

**Быстрое сохранение:**
- Нажмите **F5**
- Появится уведомление "Игра сохранена"

**Автосохранение:**
- Происходит автоматически каждые 5 минут
- Появится уведомление "Автосохранение выполнено"

**Сохранение через код:**
```csharp
// Быстрое сохранение
InGameSaveManager.Instance.QuickSave();

// Сохранение в конкретный слот
InGameSaveManager.Instance.SaveToSlot(1, "Мое сохранение");
```

---

## Что сохраняется

### Автоматически:
- ✅ Текущий счет
- ✅ Лучший счет
- ✅ Время игры
- ✅ Статистика заказов (через OrderSystem)
- ✅ Выбранный язык (через LocalCelector)
- ✅ Дата и время сохранения

### Можно добавить:
- Позицию игрока
- Состояние уровня
- Инвентарь
- Настройки

---

## Примеры кода

### Создание нового сохранения:
```csharp
int slotIndex = SaveSystem.CreateNewSave("Моя игра");
if (slotIndex >= 0)
{
    Debug.Log($"Создано сохранение в слоте {slotIndex}");
}
```

### Загрузка сохранения:
```csharp
SaveData saveData = SaveSystem.LoadFromSlot(0);
if (saveData != null)
{
    Debug.Log($"Загружено: {saveData.slotName}");
    Debug.Log($"Счет: {saveData.currentScore}");
}
```

### Проверка существования:
```csharp
if (SaveSystem.SlotExists(0))
{
    Debug.Log("Слот 0 занят");
}
else
{
    Debug.Log("Слот 0 пуст");
}
```

### Удаление сохранения:
```csharp
SaveSystem.DeleteSlot(1);
Debug.Log("Слот 1 удален");
```

---

## Расположение файлов

Сохранения находятся в:
```
Windows: C:\Users\[Username]\AppData\LocalLow\[CompanyName]\[ProductName]\Saves\
  - save_slot_0.json
  - save_slot_1.json
  - save_slot_2.json
```

Формат JSON (читаемый):
```json
{
  "slotName": "Моя игра",
  "saveDateTime": "07.12.2025 23:45",
  "slotIndex": 0,
  "currentScore": 150,
  "highScore": 200,
  "playTime": 1234.5,
  ...
}
```

---

## Возможные проблемы

### Сохранения не отображаются
**Решение:**
1. Проверьте, что SaveSlotsManager настроен
2. Вызовите `RefreshSlots()` вручную
3. Проверьте консоль на ошибки

### Не работает быстрое сохранение
**Решение:**
1. Проверьте, что InGameSaveManager в сцене
2. Убедитесь, что Save Key = F5
3. Проверьте, что объект активен

### Данные не сохраняются
**Решение:**
1. Проверьте, что ScoreManager.Instance существует
2. Убедитесь, что OrderSystem сохраняет статистику
3. Посмотрите логи в консоли

---

## Расширение системы

### Добавление подтверждения удаления:

```csharp
public void DeleteSave(int slotIndex)
{
    // Показать диалог подтверждения
    ConfirmationDialog.Show(
        "Удалить сохранение?",
        "Это действие нельзя отменить",
        () => {
            SaveSystem.DeleteSlot(slotIndex);
            RefreshSlots();
        }
    );
}
```

### Добавление скриншота сохранения:

```csharp
// В SaveData добавить:
public string screenshotPath = "";

// При сохранении:
string screenshotPath = CaptureScreenshot();
saveData.screenshotPath = screenshotPath;
```

---

## Готово!

Система слотов сохранений полностью настроена:
- ✅ 3 слота в главном меню
- ✅ Создание с названием
- ✅ Быстрое сохранение F5
- ✅ Автосохранение каждые 5 минут
- ✅ Удаление сохранений
- ✅ Отображение информации (дата, счет, уровень)
