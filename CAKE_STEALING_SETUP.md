# Настройка системы утаскивания коржей тараканами

## Описание
Тараканы достигают торта, становятся в очередь и начинают утаскивать нижний корж. Чем больше тараканов, тем быстрее утаскивается корж.

---

## Настройка

### Шаг 1: Создайте CakeManager

1. **Создайте пустой объект в сцене:**
   - **Hierarchy → ПКМ → Create Empty**
   - Назовите **"CakeManager"**

2. **Добавьте компонент:**
   - Выберите объект **CakeManager**
   - **Add Component → Cake Manager**

### Шаг 2: Настройте CakeManager в Inspector

#### Настройки торта:
- **Under Cake Plate**: перетащите объект **UnderCake** (тарелку) из Hierarchy
- **Cake Layers**: список коржей на торте (можно оставить пустым - соберется автоматически)

#### Настройки утаскивания:
- **Base Steal Speed**: базовая скорость утаскивания (например, **0.5**)
- **Speed Per Enemy**: дополнительная скорость за каждого таракана (например, **0.3**)
  - 1 таракан: скорость = 0.5
  - 2 таракана: скорость = 0.5 + 0.3 = 0.8
  - 3 таракана: скорость = 0.5 + 0.6 = 1.1
- **Queue Spacing**: расстояние между тараканами в очереди (например, **0.5**)

#### Позиции очереди:
- **First Enemy Offset**: смещение первого таракана от тарелки (например, **X: 0.5, Y: 0, Z: 0**)

### Шаг 3: Настройте теги

1. **Добавьте тег "Cake" к тарелке (UnderCake):**
   - Выберите объект **UnderCake** в Hierarchy
   - В Inspector найдите поле **Tag**
   - Если тега "Cake" нет:
     - Выберите **Add Tag...**
     - Нажмите **+**
     - Введите **"Cake"**
     - Сохраните
   - Вернитесь к UnderCake и установите тег **"Cake"**

2. **Коржи на торте:**
   - Убедитесь, что коржи имеют компонент **PickupObject** с типом **Korzh**
   - CakeManager автоматически найдет их при старте

---

## Как это работает

### 1. Тараканы идут к торту
- Тараканы автоматически находят объект с тегом "Cake"
- Двигаются к нему

### 2. Достижение торта
- Когда таракан достигает торта (расстояние < stopDistance)
- Он регистрируется в CakeManager
- Получает позицию в очереди

### 3. Очередь тараканов
- Первый таракан стоит у тарелки (смещение firstEnemyOffset)
- Второй таракан стоит за первым (+ queueSpacing)
- Третий за вторым и т.д.

### 4. Утаскивание коржа
- CakeManager берет **нижний корж** из списка
- Начинает его утаскивать вниз
- Скорость зависит от количества тараканов:
  ```
  Скорость = baseStealSpeed + (количество_тараканов - 1) * speedPerEnemy
  ```

### 5. Динамическое ускорение
- Если во время утаскивания приходят новые тараканы, скорость увеличивается
- Если тараканы уходят/уничтожаются, скорость уменьшается

### 6. Завершение
- Когда корж утащен, он уничтожается
- Начинается утаскивание следующего нижнего коржа
- Когда все коржи утащены, выводится сообщение "Игра окончена!"

---

## Примеры настроек

### Медленное утаскивание (легкая сложность):
- Base Steal Speed: **0.3**
- Speed Per Enemy: **0.2**
- 1 таракан: 0.3 ед/сек (очень медленно)
- 3 таракана: 0.7 ед/сек (медленно)

### Среднее утаскивание (средняя сложность):
- Base Steal Speed: **0.5**
- Speed Per Enemy: **0.3**
- 1 таракан: 0.5 ед/сек
- 3 таракана: 1.1 ед/сек

### Быстрое утаскивание (сложная сложность):
- Base Steal Speed: **0.8**
- Speed Per Enemy: **0.5**
- 1 таракан: 0.8 ед/сек (быстро)
- 3 таракана: 1.8 ед/сек (очень быстро)

---

## Автоматический сбор коржей

CakeManager автоматически собирает коржи при старте:
- Ищет все объекты с компонентом **PickupObject** типа **Korzh**
- Проверяет, что они находятся рядом с тарелкой (в радиусе 2 единиц)
- Сортирует их по высоте (снизу вверх)

Если нужно вручную добавить коржи:
1. Выберите **CakeManager** в Hierarchy
2. В Inspector найдите **Cake Layers**
3. Увеличьте **Size**
4. Перетащите коржи из Hierarchy в список
5. **Важно**: добавляйте снизу вверх!

---

## Добавление коржей во время игры

Если игрок добавляет новые коржи на торт:

```csharp
// Получить CakeManager
CakeManager cakeManager = FindObjectOfType<CakeManager>();

// Добавить корж
cakeManager.AddCakeLayer(korzhGameObject);
```

CakeManager автоматически отсортирует коржи по высоте.

---

## Отладка

### Консольные сообщения:

**CakeManager:**
- ✅ `"CakeManager нашел тарелку: [имя]"` - тарелка найдена
- ✅ `"CakeManager собрал X коржей"` - коржи собраны
- ⚠️ `"Тарелка UnderCake не найдена!"` - проверьте имя объекта

**Очередь тараканов:**
- ✅ `"Таракан добавлен в очередь. Всего тараканов: X"` - таракан зарегистрирован
- ✅ `"Таракан удален из очереди. Осталось тараканов: X"` - таракан ушел

**Утаскивание:**
- ✅ `"Тараканы утаскивают корж! Скорость: X (тараканов: Y)"` - начато утаскивание
- ✅ `"Корж утащен! Осталось коржей: X"` - корж уничтожен
- ✅ `"Все коржи утащены! Игра окончена!"` - все коржи утащены

**EnemyMove:**
- ⚠️ `"CakeManager не найден!"` - создайте объект с CakeManager

### Проверка в игре:

1. **Тараканы идут к торту:**
   - Запустите игру
   - Создайте таракана (через спавнер)
   - Таракан должен двигаться к тарелке UnderCake

2. **Очередь формируется:**
   - Создайте несколько тараканов
   - Они должны выстроиться в линию у тарелки

3. **Корж утаскивается:**
   - Нижний корж должен медленно двигаться вниз
   - С большим количеством тараканов - быстрее

4. **Скорость увеличивается:**
   - Во время утаскивания создайте еще тараканов
   - Корж должен начать двигаться быстрее

---

## Визуализация в Scene View

- Выберите **CakeManager** в Hierarchy
- Вы увидите список коржей в Inspector
- Можете наблюдать, как коржи удаляются из списка при утаскивании

---

## Интеграция с игровой логикой

### Проверка окончания игры:

```csharp
CakeManager cakeManager = FindObjectOfType<CakeManager>();

if (!cakeManager.HasCakeLayers())
{
    // Все коржи утащены - игра проиграна
    GameOver();
}
```

### Получение позиции тарелки:

```csharp
Vector3 platePos = cakeManager.GetPlatePosition();
```

---

## Возможные проблемы

### Тараканы не идут к торту:
- Проверьте, что у UnderCake есть тег **"Cake"**
- Проверьте, что у тараканов есть компонент **EnemyMove**

### Коржи не утаскиваются:
- Проверьте, что **CakeManager** создан в сцене
- Проверьте, что список **Cake Layers** не пуст
- Проверьте консоль на наличие ошибок

### Тараканы не выстраиваются в очередь:
- Проверьте значение **Queue Spacing** (должно быть > 0)
- Проверьте **First Enemy Offset**

### Корж утаскивается слишком быстро/медленно:
- Настройте **Base Steal Speed** и **Speed Per Enemy**
- Уменьшите количество одновременных тараканов (в EnemySpawner)
